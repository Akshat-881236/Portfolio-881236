<!DOCTYPE html>
<html>
<head>
  <title>Simple Fee Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap -->
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body { background:#f5f5f5; }
    .card { margin-bottom:15px; }
    .sibling-box { background:#fff; padding:10px; border-radius:6px; margin-bottom:8px; }
  </style>
</head>

<body class="container py-3">

<h3 class="text-center mb-3">Simple Fee Portal</h3>

<!-- ---------------------------------
     FEE ENTRY FORM
----------------------------------- -->
<div class="card p-3">
  <h5>Fee Entry</h5>

  <div class="mb-2">
    <label>Student ID</label>
    <input id="sid" class="form-control">
  </div>

  <div class="mb-2">
    <label>Student Name</label>
    <input id="sname" class="form-control">
  </div>

  <div class="mb-2">
    <label>Class</label>
    <input id="sclass" class="form-control">
  </div>

  <div class="mb-2">
    <label>Father Name</label>
    <input id="fname" class="form-control">
  </div>

  <div class="mb-2">
    <label>Mother Name</label>
    <input id="mname" class="form-control">
  </div>

  <hr>

  <h6>Siblings</h6>
  <div id="siblings"></div>

  <button class="btn btn-sm btn-primary mb-3"
          onclick="addSibling()">+ Add Sibling</button>

  <hr>

  <div class="mb-2">
    <label>Fee (₹)</label>
    <input id="fee" class="form-control" type="number" value="300">
  </div>

  <div class="mb-2">
    <label>Amount Paid (₹)</label>
    <input id="paid" class="form-control" type="number">
  </div>

  <button class="btn btn-success w-100" onclick="saveSlip()">Save Slip</button>
</div>

<!-- ---------------------------------
     SLIP PREVIEW LIST
----------------------------------- -->
<div class="card p-3">
  <h5>All Slips</h5>
  <div id="allSlips"></div>
</div>

<script>
let siblings = [];

function addSibling() {
  const box = document.createElement("div");
  box.className = "sibling-box";

  box.innerHTML = `
    <div class="row g-1">
      <div class="col-6">
        <input class="form-control sib-id" placeholder="Sibling ID">
      </div>
      <div class="col-6">
        <input class="form-control sib-name" placeholder="Sibling Name">
      </div>
    </div>
  `;

  document.getElementById("siblings").appendChild(box);
}

function saveSlip() {
  const id = document.getElementById("sid").value;
  const name = document.getElementById("sname").value;
  const cls = document.getElementById("sclass").value;
  const father = document.getElementById("fname").value;
  const mother = document.getElementById("mname").value;
  const fee = Number(document.getElementById("fee").value);
  const paid = Number(document.getElementById("paid").value);

  const sibs = [];
  document.querySelectorAll(".sibling-box").forEach(box => {
    sibs.push({
      id: box.querySelector(".sib-id").value,
      name: box.querySelector(".sib-name").value
    });
  });

  const slip = {
    slipId: Date.now(),
    id, name, cls, father, mother, fee, paid,
    balance: fee - paid,
    siblings: sibs,
    date: new Date().toLocaleDateString()
  };

  // save in localStorage
  let arr = JSON.parse(localStorage.getItem("slips") || "[]");
  arr.push(slip);
  localStorage.setItem("slips", JSON.stringify(arr));

  alert("Slip Saved!");
  showSlips();
  makePDF(slip);
}

/* ---------------------------------
   SHOW ALL SAVED SLIPS
----------------------------------*/
function showSlips() {
  let arr = JSON.parse(localStorage.getItem("slips") || "[]");
  let box = document.getElementById("allSlips");
  box.innerHTML = "";

  arr.forEach(slip => {
    let div = document.createElement("div");
    div.className = "p-2 border rounded mb-2 bg-white";

    div.innerHTML = `
      <b>${slip.name}</b> (${slip.id})<br>
      Fee: ₹${slip.fee} | Paid: ₹${slip.paid} | <b>Balance: ₹${slip.balance}</b><br>
      <small>${slip.date}</small><br>
      <button class="btn btn-sm btn-outline-primary mt-1"
              onclick='makePDF(${JSON.stringify(slip)})'>Download PDF</button>
    `;

    box.appendChild(div);
  });
}

/* ---------------------------------
   PDF GENERATOR
----------------------------------*/
function makePDF(slip) {
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();

  let y = 10;
  pdf.text("FEE RECEIPT", 80, y); y+=10;
  pdf.text("Slip ID: " + slip.slipId, 10, y); y+=8;

  pdf.text("Student ID: " + slip.id, 10, y); y+=8;
  pdf.text("Name: " + slip.name, 10, y); y+=8;
  pdf.text("Class: " + slip.cls, 10, y); y+=8;

  pdf.text("Father: " + slip.father, 10, y); y+=8;
  pdf.text("Mother: " + slip.mother, 10, y); y+=8;

  pdf.text("Siblings:", 10, y); y+=8;
  slip.siblings.forEach(s => {
    pdf.text("- " + s.id + " " + s.name, 15, y);
    y += 7;
  });

  pdf.text("Fee: ₹" + slip.fee, 10, y); y+=8;
  pdf.text("Paid: ₹" + slip.paid, 10, y); y+=8;
  pdf.text("Balance: ₹" + slip.balance, 10, y); y+=8;

  pdf.save("Slip_" + slip.slipId + ".pdf");
}

/* Load slips at start */
showSlips();
</script>

</body>
</html>